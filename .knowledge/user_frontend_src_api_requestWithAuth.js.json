{"is_source_file": true, "format": "JavaScript", "description": "This file implements a wrapper around the fetch API to facilitate authenticated HTTP requests with automatic token refresh on 401 responses. It handles attaching access tokens, managing refresh tokens, and retrying failed requests after refreshing tokens.", "external_files": ["./gatewayClient"], "external_methods": ["gatewayRefresh"], "published": ["requestWithAuth"], "classes": [], "methods": [{"name": "normalizeError(res, data)", "description": "Generates an Error object encapsulating the HTTP response's error details.", "scope": "", "scopeKind": ""}, {"name": "refreshAccessTokenSingleFlight({ refreshToken })", "description": "Ensures only one token refresh request is in-flight at a time, preventing multiple simultaneous refreshes.", "scope": "", "scopeKind": ""}, {"name": "requestWithAuth({ baseUrl, path, method = 'GET', body, headers, accessToken, setAccessToken, refreshToken, setRefreshToken, retryOn401 = true, onAuthFailure, })", "description": "Performs an HTTP request with optional authorization headers, handles 401 responses by refreshing tokens and retrying once.", "scope": "", "scopeKind": ""}, {"name": "doFetch(token)", "scope": "requestWithAuth", "scopeKind": "function", "description": "unavailable"}], "calls": ["fetch", "gatewayRefresh"], "search-terms": ["requestWithAuth", "token refresh", "fetch wrapper", "authorization", "single-flight refresh"], "state": 2, "file_id": 15, "knowledge_revision": 60, "git_revision": "6bdc9c14a719ed6812ca8760ef8382ce0990bee3", "revision_history": [{"42": ""}, {"60": "6bdc9c14a719ed6812ca8760ef8382ce0990bee3"}], "ctags": [{"_type": "tag", "name": "doFetch", "path": "/home/kavia/workspace/code-generation/user-portal-platform-228610-228620/user_frontend/src/api/requestWithAuth.js", "pattern": "/^  async function doFetch(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)", "scope": "requestWithAuth", "scopeKind": "function"}, {"_type": "tag", "name": "inFlightRefreshPromise", "path": "/home/kavia/workspace/code-generation/user-portal-platform-228610-228620/user_frontend/src/api/requestWithAuth.js", "pattern": "/^let inFlightRefreshPromise = null;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "normalizeError", "path": "/home/kavia/workspace/code-generation/user-portal-platform-228610-228620/user_frontend/src/api/requestWithAuth.js", "pattern": "/^function normalizeError(res, data) {$/", "language": "JavaScript", "kind": "function", "signature": "(res, data)"}, {"_type": "tag", "name": "refreshAccessTokenSingleFlight", "path": "/home/kavia/workspace/code-generation/user-portal-platform-228610-228620/user_frontend/src/api/requestWithAuth.js", "pattern": "/^async function refreshAccessTokenSingleFlight({ refreshToken }) {$/", "language": "JavaScript", "kind": "function", "signature": "({ refreshToken })"}, {"_type": "tag", "name": "requestWithAuth", "path": "/home/kavia/workspace/code-generation/user-portal-platform-228610-228620/user_frontend/src/api/requestWithAuth.js", "pattern": "/^export async function requestWithAuth({$/", "language": "JavaScript", "kind": "function", "signature": "({ baseUrl, path, method = 'GET', body, headers, accessToken, setAccessToken, refreshToken, setRefreshToken, retryOn401 = true, onAuthFailure, })"}], "hash": "0af0c9cd35ecb94ac35a75d608541e89", "format-version": 4, "code-base-name": "user_frontend", "filename": "user_frontend/src/api/requestWithAuth.js", "fields": [{"name": "let inFlightRefreshPromise = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}